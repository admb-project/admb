DISTRIBUTION_NAME=ADMB

#TIGER=10.4
#LEOPARD=10.5
#SNOW_LEOPARD=10.6

CC=/Developer/Applications/Utilities/PackageMaker.app/Contents/MacOS/PackageMaker

all:
	rm -rvf build/dmg/@target@/Resources
	mkdir -p build/dmg/@target@/Resources

	rm -rvf build/dmg/@target@/installer
	mkdir -p build/dmg/@target@/installer/usr/local/bin
	mkdir -p build/dmg/@target@/installer/usr/local/admb

	cp -Rvf build/@target@/* build/dmg/@target@/installer/usr/local/admb
	rm -rvf `find build/dmg/@target@/installer -type d -name .svn`

	cp -vf scripts/admb/admb-bin build/dmg/@target@/installer/usr/local/bin/admb

	cp -vf build/dmg/@target@/installer/usr/local/admb/README.txt build/dmg/@target@/Resources/Welcome.txt
	cp -vf build/dmg/@target@/installer/usr/local/admb/LICENSE.txt build/dmg/@target@/Resources/License.txt
	cp -vf scripts/installers/packagemaker/Resources/background.jpg  build/dmg/@target@/Resources/
	mkdir -p build/dmg/@target@/package
	cp -vf docs/install/readme-macos.txt  build/dmg/@target@/package
	$(CC) --verbose --title $(DISTRIBUTION_NAME) --root build/dmg/@target@/installer --id www.admb-project.org --resources build/dmg/@target@/Resources --out build/dmg/@target@/package/@target@.pkg
	rm -vf build/@target@.dmg
	hdiutil create build/@target@.dmg -volname "ADMB @version@" -srcfolder build/dmg/@target@/package
